--LABORATOR 7

------------------------------------------------------------------------------

!!!!!! Atentie la denumirea tabelelor si a constrangerilor!!!!!!
se foloseste -> “pnu” unde p reprezintă prima literă a prenumelui, iar nu reprezintă primele două litere ale numelui

------------------------------------------------------------------------------

1. Să se creeze tabelele EMP_pnu, DEPT_pnu (în care şirul de caractere “pnu”, 
p reprezintă prima literă a prenumelui, iar nu reprezintă primele două litere ale numelui), 
prin copierea structurii şi conţinutului tabelelor EMPLOYEES, respectiv DEPARTMENTS.

CREATE TABLE EMP_pnu AS SELECT * FROM employees;

CREATE TABLE DEPT_pnu AS SELECT * FROM departments;

select * from employees;
select * from departments;

select * from emp_pnu;
select * from dept_pnu;

2. Listaţi structura tabelelor sursă şi a celor create anterior. Ce se observă?

desc employees;
desc emp_pnu;

desc dept_pnu;

-- observam faptul ca nu se copiaza si constrangerile de integritate - chei primare, chei externe

3. Listaţi conţinutul tabelelor create anterior

select * from employees;
select * from departments;

select * from emp_pnu;
select * from dept_pnu;

-- continut se copiaza in totalitate

4. Pentru introducerea constrângerilor de integritate, executaţi instrucţiunile LDD indicate în continuare.

ALTER TABLE emp_pnu
ADD CONSTRAINT pk_emp_pnu PRIMARY KEY(employee_id);

ALTER TABLE dept_pnu
ADD CONSTRAINT pk_dept_pnu PRIMARY KEY(department_id);

ALTER TABLE emp_pnu
ADD CONSTRAINT fk_emp_dept_pnu
FOREIGN KEY(department_id) REFERENCES dept_pnu(department_id);


rollback; -- in acest caz rollback nu are efect deoarece ALTER este o comanda care 
          -- realizeaza commit implicit 
          -- rollback se intoarce pana la ultimul commit -> commit implicit sau explicit

Ce constrângere nu am implementat?

ALTER TABLE emp_pnu 
ADD CONSTRAINT fk_emp_sef_pnu FOREIGN KEY(manager_id) REFERENCES emp_pnu(employee_id);

ALTER TABLE dept_pnu 
ADD CONSTRAINT fk_dept_sef_pnu FOREIGN KEY(manager_id) REFERENCES emp_pnu(employee_id);
-----commit implicit

5. Să se insereze departamentul 300, cu numele Programare în DEPT_pnu.
Analizaţi cazurile, precizând care este soluţia corectă şi explicând erorile celorlalte variante. 
Pentru a anula efectul instrucţiunii(ilor) corecte, utilizaţi comanda ROLLBACK.

--a) not enough values
-- varianta implicita de inserare in care nu se precizeaza coloanele 
INSERT INTO DEPT_pnu
VALUES (300, 'Programare');

desc dept_pnu;

--b) corecta
-- varianta explicita de inserare 
INSERT INTO DEPT_pnu (department_id, department_name)
VALUES (300, 'Programare');

select * from dept_pnu;
rollback; -- ce se intampla daca in acest punct face rollback
   -- anuleaza toate modificarile facute pana la ultimul commit
   
commit;

commit automat -> create, alter, drop ;

--c) --invalid number
INSERT INTO DEPT_pnu (department_name, department_id)
VALUES (300, 'Programare');

--d) -- unique constraint (GRUPA42.PK_DEPT_PNU) violated
INSERT INTO DEPT_pnu (department_id, department_name, location_id)
VALUES (300, 'Programare', null);

INSERT INTO DEPT_pnu (department_id, department_name, location_id)
VALUES (301, 'Programare', null);

commit;

select * from dept_pnu;

--e) -- cannot insert NULL into ("GRUPA42"."DEPT_PNU"."DEPARTMENT_ID")
INSERT INTO DEPT_pnu (department_name, location_id)
VALUES ('Programare', null);

6. Să se insereze un angajat corespunzător departamentului introdus anterior în tabelul EMP_pnu, 
precizând valoarea NULL pentru coloanele a căror valoare nu este cunoscută la inserare 
(metoda implicită de inserare). Determinaţi ca efectele instrucţiunii să devină permanente;

insert into emp_pnu
values (257, NULL, 'nume257', 'email257', NULL, sysdate, 'it_prog', NULL, NULL, NULL, 300);

desc emp_pnu;

select * from emp_pnu
where employee_id = 257;

commit;

7. Să se mai introducă un angajat corespunzător departamentului 300, 
precizând după numele tabelului lista coloanelor în care se introduc valori (metoda explicita de inserare). 
Se presupune că data angajării acestuia este cea curentă (SYSDATE). Salvaţi înregistrarea.

INSERT INTO emp_pnu (hire_date, job_id, employee_id, last_name, email, department_id)
VALUES (sysdate, 'sa_man', 278, 'nume_278', 'email_278', 300);

COMMIT;

9. Creaţi un nou tabel, numit EMP1_PNU, care va avea aceeaşi structură ca şi EMPLOYEES, dar nici o înregistrare. 
Copiaţi în tabelul EMP1_PNU salariaţii (din tabelul EMPLOYEES) al căror comision depăşeşte 25% din salariu.

create table emp1_pnu as select * from employees;

select * from emp1_pnu;

DELETE FROM emp1_pnu;

insert into nume_tabel
    subcerere;
    
insert into emp1_pnu
     select *
     from employees
     where commission_pct > 0.25;

select * from emp1_pnu;

rollback; -- anuleaza toate modificarile pana la create deoarece create realizeaza commit implicit

--7
INSERT INTO emp_pnu (employee_id, first_name, last_name, email, hire_date, job_id, salary)
VALUES(&cod, '&&prenume', '&&nume', substr('&prenume',1,1) || substr('&nume',1,7), sysdate, 'it_prog',&sal);
UNDEFINE prenume;
UNDEFINE nume;

select * from emp_pnu;

rollback;

12. Creaţi 2 tabele emp2_pnu şi emp3_pnu cu aceeaşi structură ca tabelul EMPLOYEES, 
dar fără înregistrări (acceptăm omiterea constrângerilor de integritate). 
Prin intermediul unei singure comenzi, copiaţi din tabelul EMPLOYEES:

- în tabelul EMP1_PNU salariaţii care au salariul mai mic decât 5000;
- în tabelul EMP2_PNU salariaţii care au salariul cuprins între 5000 şi 10000;
- în tabelul EMP3_PNU salariaţii care au salariul mai mare decât 10000.

INSERT [ALL | FIRST]
WHEN condiţie THEN INTO…
[WHEN condiţie THEN INTO…
[ELSE INTO …]]
subcerere;

create table emp1_pnu as select * from employees;
create table emp2_pnu as select * from employees;
create table emp3_pnu as select * from employees;

select * from emp1_pnu;
select * from emp2_pnu;
select * from emp3_pnu;

DELETE FROM emp1_pnu;
DELETE FROM emp2_pnu;
DELETE FROM emp3_pnu;

insert all
when salary < 5000 then into emp1_pnu
when salary >= 5000 and salary <= 10000 then into emp2_pnu
else into emp3_pnu
    select * from employees;


