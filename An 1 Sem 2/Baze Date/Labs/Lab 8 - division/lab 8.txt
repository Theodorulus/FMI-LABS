--LBAORATOR 6 (OPERATORUL DIVISION)

desc projects;

select * from projects;

select * from works_on;

desc works_on;



Exemplu: Să se obţină codurile salariaţilor ataşaţi tuturor proiectelor pentru care s-a alocat un buget egal cu 10000.

--Metoda 1 (utilizând de 2 ori NOT EXISTS):
SELECT DISTINCT employee_id
FROM works_on a
WHERE NOT EXISTS (SELECT 1
                  FROM project p
                  WHERE budget = 10000
                  AND NOT EXISTS
                        (SELECT 'x'
                         FROM works_on b
                         WHERE p.project_id = b.project_id
                         AND b.employee_id = a.employee_id
                        )
                 );


--Metoda 2 (simularea diviziunii cu ajutorul funcţiei COUNT):
SELECT employee_id
FROM works_on
WHERE project_id IN (SELECT project_id
                     FROM projects
                     WHERE budget = 10000)
GROUP BY employee_id
HAVING COUNT(project_id)=(SELECT COUNT(*)
                          FROM projects
                          WHERE budget = 10000);


--Metoda 3 (operatorul MINUS):
SELECT employee_id
FROM works_on

MINUS

SELECT employee_id 
from ( SELECT employee_id, project_id
       FROM (SELECT DISTINCT employee_id FROM works_on) t1,
            (SELECT project_id FROM projects WHERE budget = 10000) t2
        
       MINUS
 
       SELECT employee_id, project_id FROM works_on
     ) t3;
 
 
--Metoda 4 (A include B => B\A = Ø):

SELECT DISTINCT employee_id
FROM works_on a
WHERE NOT EXISTS ( (SELECT project_id
                    FROM projects p
                    WHERE budget = 10000
                    )

                    MINUS

                   (SELECT p.project_id
                    FROM project p, works_on b
                    WHERE p.project_id = b.project_id AND b.employee_id = a.employee_id
                   )
                );

1. Să se listeze informaţii despre angajaţii care au lucrat în toate proiectele demarate în primele 6 luni ale anului 2006. 

select employee_id, first_name, last_name
from employees
where employee_id in (select employee_id
                      from works_on
                      where project_id in (select project_id
                                           from projects
                                           where start_date >= to_date('01-jan-06') and start_date <=('30-jun-06')
                                           )
                      group by employee_id
                      having count(project_id) = (select count(project_id)
                                                  from projects
                                                  where start_date >= to_date('01-jan-06') and start_date <=('30-jun-06')
                                                 )
                     );


2. Să se listeze informaţii despre proiectele la care au participat toţi angajaţii care au deţinut alte 2
posturi în firmă.



select *
from projects
where project_id in (select project_id
                     from works_on
                     where employee_id in (select employee_id
                                           from job_history
                                           group by employee_id
                                           having count(employee_id) = 2
                                          )
                     group by project_id
                     having count(employee_id) = (select count(count(employee_id))
                                                  from job_history
                                                  group by employee_id
                                                  having count(employee_id) = 2)
                    );


3. Să se obţină numărul de angajaţi care au avut cel puţin trei job-uri, luându-se în considerare şi
job-ul curent.

select count(employee_id) Nr_Angajati
from job_history
group by employee_id
having count(employee_id) >= 2;

4. Pentru fiecare ţară, să se afişeze numărul de angajaţi din cadrul acesteia.

select count(employee_id)
from employees join departments using(department_id)
               join locations using(location_id)
               join countries using(country_id)
group by country_id;


--tema: 5, 6, 7

















